<launch>
    <arg name="surf_mapping_method" default="bayesian_hilbert" />
    <!-- Options: gp_occ, bayesian_hilbert -->
    <arg name="visualize_sdf" default="true" />
    <!-- whether to launch rviz for visualization -->
    <arg name="open_rviz" default="true" />
    <!-- whether to launch rqt_plot for performance analysis -->
    <arg name="open_rqt_plot" default="true" />

    <arg name="bag_file" default="$(env HOME)/Data/NewerCollege/dlio_newer_college_recording.bag" />
    <arg name="rosbag_play_rate" default="0.25" />
    <arg name="rosbag_play_duration" default="10000.0" />
    <arg name="play_rosbag" default="true" />

    <node pkg="erl_gp_sdf_ros" type="sdf_mapping_node" name="sdf_mapping_node" output="screen">
        <rosparam command="load"
            file="$(find erl_gp_sdf_ros)/config/ros1/$(arg surf_mapping_method)_float_3d.yaml" />
        <rosparam command="load" file="$(find erl_gp_sdf_ros)/config/ros1/use_lidar_frame_3d_float.yaml" />
        <param name="scan_frame_setting_file" value="" />
        <param name="map_dim" value="3" />
        <param name="double_precision" value="false" />
        <param name="surface_mapping_setting_file"
            value="$(find erl_gp_sdf)/config/newer_college/$(arg surf_mapping_method)/surf_mapping_float_scale0.1.yaml" />
        <param name="sdf_mapping_setting_file"
            value="$(find erl_gp_sdf)/config/newer_college/$(arg surf_mapping_method)/sdf_mapping_float.yaml" />
        <param name="use_odom" value="false" />
        <param name="odom_topic" value="/robot/dlio/odom_node/odom" />
        <param name="odom_msg_type" value="odometry" />
        <param name="world_frame" value="robot/odom" />
        <param name="sensor_frame" value="robot/dlio/os_sensor" />
        <param name="scan_topic" value="/robot/dlio/odom_node/pointcloud/deskewed" />
        <param name="scan_type" value="point_cloud" />
        <param name="scan_stride" value="1" />
        <param name="convert_scan_to_points" value="$(eval surf_mapping_method == 'bayesian_hilbert')" />
        <!-- <param name="scan_in_local_frame" value="true" /> -->
        <param name="scan_in_local_frame" value="false" />
        <param name="publish_tree" value="true" />
    </node>

    <group if="$(arg visualize_sdf)">
        <node pkg="erl_gp_sdf_ros" type="sdf_visualization_node" name="sdf_visualization_node"
            output="screen">
            <param name="resolution" value="0.1" />
            <param name="x_cells" value="101" />
            <param name="y_cells" value="101" />
            <param name="x" value="0" />
            <param name="y" value="0" />
            <param name="z" value="0" />
            <param name="publish_gradient" value="true" />
            <param name="publish_sdf_variance" value="true" />
            <param name="publish_gradient_variance" value="false" />
            <param name="publish_covariance" value="false" />
            <param name="publish_grid_map" value="true" />
            <param name="publish_point_cloud" value="false" />
            <param name="publish_rate" value="4.0" />
            <!-- change to true if you want to visualize SDF around the robot -->
            <param name="attached_to_frame" value="true" />
            <param name="world_frame" value="robot/odom" />
            <param name="attached_frame" value="robot/dlio/os_sensor" />
            <param name="sdf_query_service" value="/sdf_mapping_node/sdf_query" />
            <param name="map_topic" value="sdf_grid_map" />
            <param name="point_cloud_topic" value="sdf_point_cloud" />
        </node>
    </group>

    <group if="$(arg open_rviz)">
        <node pkg="rviz" type="rviz" name="rviz"
            args="-d $(find erl_gp_sdf_ros)/rviz/newer_college.rviz" />
    </group>

    <group if="$(arg open_rqt_plot)">
        <node pkg="rqt_plot" type="rqt_plot" name="rqt_plot"
            args="/sdf_mapping_node/update_time/data /sdf_mapping_node/query_time/data" />
    </group>

    <group if="$(arg play_rosbag)">
        <node pkg="rosbag" type="play" name="rosbag_play"
            args="$(arg bag_file) --rate=$(arg rosbag_play_rate) --start=6.5  --duration=$(arg rosbag_play_duration)
            --clock"
            output="screen" />
    </group>

</launch>